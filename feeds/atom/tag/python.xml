<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>CLI! CLI! CLI!</title>
    <link href="https://cj-bc.github.io/blog/feeds/atom/tag/python.xml" rel="self" />
    <link href="https://cj-bc.github.io/blog" />
    <id>https://cj-bc.github.io/blog/feeds/atom/tag/python.xml</id>
    <author>
        <name>Cj-bc a.k.a Cj.BC_SD</name>
        <email>cj.bc-sd@outlook.jp</email>
    </author>
    <updated>2021-02-21T00:00:00Z</updated>
    <entry>
    <title>Python Language Serverにmypyにmypyの設定を追加した</title>
    <link href="https://cj-bc.github.io/blog/posts/2021-02-21-python-install-pyls-mypy-along-with-vim-lsp-settings.html" />
    <id>https://cj-bc.github.io/blog/posts/2021-02-21-python-install-pyls-mypy-along-with-vim-lsp-settings.html</id>
    <published>2021-02-21T00:00:00Z</published>
    <updated>2021-02-21T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>Python Language Serverにmypyにmypyの設定を追加した</h1>
  <div class="ui list">
    <div class="item">Posted on February 21, 2021</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on February 21, 2021
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a><a title="All pages tagged &#39;環境構築&#39;." href="/tags/%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89.html" class="ui tag label">環境構築</a>
  
</div>

<h1 id="環境">環境</h1>
<table>
<tbody>
<tr class="odd">
<td>エディター</td>
<td>vim</td>
</tr>
<tr class="even">
<td>LSPクライアント</td>
<td>vim-lsp</td>
</tr>
<tr class="odd">
<td>PythonのLSP</td>
<td><a href="https://github.com/palantir/python-language-server">https://github.com/palantir/python-language-server</a></td>
</tr>
<tr class="even">
<td>他</td>
<td><a href="https://github.com/mattn/vim-lsp-settings">mattn/vim-lsp-settings</a> 使用</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="pyls-mypy">pyls-mypy</h1>
<p><em>pyls-mypy</em> はその名前の通り、Pyls(palantir氏のもの)にmypy対応させるプラグインです。</p>
<p>私は型大好き人間でAnnotationを頻繁に使うため、入れます。</p>
<h2 id="Install先">Install先</h2>
<p><em>pyls</em> を <em>vim-lsp-settings</em> で導入しているので、それがインストールしているのと同じ環境に <em>pyls-mypy</em> を入れてあげる 必要があります。</p>
<p>これは、 <code>XDG_DATA_HOME</code> が設定されていれば <code>XDG_DATA_HOME/vim-lsp-settings/servers</code> 、設定されていなければ <code>~/.local/share/vim-lsp-settings/servers</code> になります。</p>
<p>又、 <code>pyls</code> 自体はそのディレクトリの下に <code>pyls-all/venv</code> 等としてvenvを作っています。 なので、それを呼べばいいわけです。</p>
<p>自分用のスクリプトがdotfileにあるのですが、まだcommitしてないので実際の処理部分のみ載せます。 後にリンクに変えるかもしれません。</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb1" data-org-language="sh"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="va">vimLspSettings_dataDir=</span><span class="st">&quot;</span><span class="va">${XDG_DATA_HOME:-$HOME</span>/.local/share<span class="va">}</span><span class="st">/vim-lsp-settings}&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">[[</span> <span class="ot">-d</span> <span class="va">$vimLspSettings_dataDir</span><span class="kw"> ]]</span> <span class="kw">&amp;&amp;</span> <span class="kw">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="bu">.</span> <span class="st">&quot;</span><span class="va">${vimLspSettings_dataDir}</span><span class="st">/servers/pyls-all/venv/bin/activate&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    <span class="ex">pip</span> install pyls-mypy</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="ex">deactivate</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a></span></code></pre></div>
</div>
]]></summary>
</entry>
<entry>
    <title>fix-typoのデバッグメモ</title>
    <link href="https://cj-bc.github.io/blog/posts/2021-02-20-blender-vrm-plugin-bugfix-after-merged-memo.html" />
    <id>https://cj-bc.github.io/blog/posts/2021-02-20-blender-vrm-plugin-bugfix-after-merged-memo.html</id>
    <published>2021-02-20T00:00:00Z</published>
    <updated>2021-02-20T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>fix-typoのデバッグメモ</h1>
  <div class="ui list">
    <div class="item">Posted on February 20, 2021</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on February 22, 2021
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a><a title="All pages tagged &#39;blender&#39;." href="/tags/blender.html" class="ui tag label">blender</a><a title="All pages tagged &#39;vrm&#39;." href="/tags/vrm.html" class="ui tag label">vrm</a><a title="All pages tagged &#39;VRM_IMPORTER_for_Blender&#39;." href="/tags/VRM_IMPORTER_for_Blender.html" class="ui tag label">VRM_IMPORTER_for_Blender</a>
  
</div>

<table>
<tbody>
<tr class="odd">
<td>該当PR</td>
<td><a href="https://github.com/saturday06/VRM_Addon_for_Blender/pull/23">saturday06/VRM<sub>IMPORTERforBlender</sub>: PR #23</a></td>
</tr>
<tr class="even">
<td>作業メモ</td>
<td><a href="https://Cj-bc.github.io/blog/posts/2021-01-11-blender-python-memo.html">https://Cj-bc.github.io/blog/posts/2021-01-11-blender-python-memo.html</a></td>
</tr>
</tbody>
</table>
<h1 id="問題">問題</h1>
<p><a href="https://github.com/saturday06/VRM_Addon_for_Blender/pull/23#issuecomment-782580000">issueでsaturday06さんが教えてくれた</a> のですが、「一度古いプラグインでVRMを読み込んだblendファイルで、新しくVRMを読み込むとエラーを吐く」</p>
<h2 id="トレースバック">トレースバック</h2>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>Traceback (most recent call last):
  File &quot;/Users/me/Library/Application
  Support/Blender/2.80/scripts/addons/VRM_IMPORTER_for_Blender/__init__.py&quot;,
  line 88, in execute
      blend_model.BlendModel(context, vrm_load.read_vrm(self.filepath, self),
      self)
        File &quot;/Users/me/Library/Application
        Support/Blender/2.80/scripts/addons/VRM_IMPORTER_for_Blender/importer/blend_model.py&quot;,
        line 53, in __init__
            self.vrm_model_build()
              File &quot;/Users/me/Library/Application
              Support/Blender/2.80/scripts/addons/VRM_IMPORTER_for_Blender/importer/blend_model.py&quot;,
              line 71, in vrm_model_build
                  self.make_material()
                    File &quot;/Users/me/Library/Application
                    Support/Blender/2.80/scripts/addons/VRM_IMPORTER_for_Blender/importer/blend_model.py&quot;,
                    line 333, in make_material
                        self.build_material_from_mtoon(b_mat, mat)
                          File &quot;/Users/me/Library/Application
                          Support/Blender/2.80/scripts/addons/VRM_IMPORTER_for_Blender/importer/blend_model.py&quot;,
                          line 646, in build_material_from_mtoon
                              color_socket_to_connect=sg.inputs[tex_dic[tex_name]],
                              KeyError: &#39;bpy_prop_collection[key]: key
                              &quot;NormalmapTexture&quot; not found&#39;

                              location: &lt;unknown location&gt;:-1
</code></pre>
</div>
<h1 id="バグが起きた場所">バグが起きた場所</h1>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>__init__.ImportVRM.execute()
└blend_model.BlendModel.__init__()
 └BlendModel.vrm_model_build()
  └BlendModel.make_material()
   └BlendModel.build_material_from_mtoon()
</code></pre>
</div>
<h1 id="バグの原因">バグの原因</h1>
<p><code>importer/blend_model.py:449</code> で <code>bpy.data.node_groups[shader_node_group_name]</code> を取ってきているところが原因。</p>
<p><code>bpy.data.node_groups</code> はblendfile内にある <code>node_groups</code> を保持しており、 既に「古いバージョンで読み込まれたVRM」がある場合 <code>bpy.data.node_groups["MToon_unversioned"]</code> は 「古いバージョンの <code>MToon_unversioned</code> 」=typoが含まれたものを返してしまう。</p>
<p>そうすると、 <code>node_group_create</code> から返されたのちに <code>.inputs["Normalmap"]</code> が読まれた際に存在せずにクラッシュしてしまう。</p>
<h1 id="解決方法">解決方法</h1>
<p>ここでできるのは</p>
<ol>
<li>今までと同じように"Normalmap"が存在しなかったら"Nomalmap"を読ませる</li>
<li>そもそも古い <code>bpy.data.node_groups["MToon_unversioned"]</code> を更新させる(どのタイミングで？)</li>
</ol>
]]></summary>
</entry>
<entry>
    <title>VRM_IMPORTER_for_Blender \#23 作業メモ</title>
    <link href="https://cj-bc.github.io/blog/posts/2021-01-11-blender-python-memo.html" />
    <id>https://cj-bc.github.io/blog/posts/2021-01-11-blender-python-memo.html</id>
    <published>2021-01-11T00:00:00Z</published>
    <updated>2021-01-11T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>VRM_IMPORTER_for_Blender \#23 作業メモ</h1>
  <div class="ui list">
    <div class="item">Posted on January 11, 2021</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on January 15, 2021
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;blender&#39;." href="/tags/blender.html" class="ui tag label">blender</a><a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a>
  
</div>

<h1 id="追加されたシェーダーを探す">追加されたシェーダーを探す</h1>
<h2 id="場所の特定">場所の特定</h2>
<p>そもそもファイルがどこに追加されているのかを確かめる必要がある。 そこで、<code>__init__.py</code>を参照する。(どうでもいいけど中身のある<code>__init__.py</code>は初めて見た)<br />
Blenderは、Addonが追加されるとクラスなどを登録するために<code>register()</code>という関数を探して実行する。 以下がこのAddonの<code>register()</code>関数。 (<a href="https://github.com/saturday06/VRM_IMPORTER_for_Blender/blob/a14835bfbc573a1d8f2be2a74ed198da46a573e4/__init__.py#L277-L285">githubで確認する</a>)</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co"># アドオン有効化時の処理</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">def</span> register():</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    <span class="cf">for</span> cls <span class="kw">in</span> classes:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>        bpy.utils.register_class(cls)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    bpy.types.TOPBAR_MT_file_import.append(menu_import)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    bpy.types.TOPBAR_MT_file_export.append(menu_export)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    bpy.types.VIEW3D_MT_armature_add.append(add_armature)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>    <span class="co"># bpy.types.VIEW3D_MT_mesh_add.append(make_mesh)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    bpy.app.handlers.load_post.append(add_shaders)</span></code></pre></div>
</div>
<p>明らかに<code>bpy.app.handlers.load_post.append(add_shaders)</code>が怪しい。というか、<code>add_shaders</code>という わかりやすい名前があるので間違い無くここで追加している。 ということで<code>add_shaders</code>を見てみると (<a href="https://github.com/saturday06/VRM_IMPORTER_for_Blender/blob/a14835bfbc573a1d8f2be2a74ed198da46a573e4/__init__.py#L245-L253">githubで確認する</a>)</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="at">@persistent</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">def</span> add_shaders(<span class="va">self</span>):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    filedir <span class="op">=</span> os.path.join(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>        os.path.dirname(<span class="va">__file__</span>), <span class="st">&quot;resources&quot;</span>, <span class="st">&quot;material_node_groups.blend&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>    )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>    <span class="cf">with</span> bpy.data.libraries.load(filedir, link<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> (data_from, data_to):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>        <span class="cf">for</span> nt <span class="kw">in</span> data_from.node_groups:</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>            <span class="cf">if</span> nt <span class="kw">not</span> <span class="kw">in</span> bpy.data.node_groups:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>                data_to.node_groups.append(nt)</span></code></pre></div>
</div>
<h2 id="実際にshaderを追加している部分">実際にshaderを追加している部分</h2>
<p>このコードである。そして、読めば字の如くだが、レポジトリにある<code>resources/material_node_groups.blend</code> にある<code>node_groups</code>の中でBlenderに存在していないものがあれば <code>data_to.node_groups.append()</code>して追加している。<br />
結論から言うと<a href="https://docs.blender.org/api/current/bpy.types.BlendData.html?highlight=node_groups#bpy.types.BlendData.node_groups"><code>node_groups</code></a>は nodeで表現されるもの(オブジェクト？)、つまり<code>Shading</code>/<code>Textures</code>/<code>Compositin</code>に関わるものの集合である。 (<a href="https://docs.blender.org/api/current/bpy.types.NodeTree.html#bpy.types.NodeTree">公式doc</a>)<br />
type()によると、<code>bpy.data</code>は<code>bpy.types.BlendData</code>であるので、<code>node_groups</code>は <a href="https://docs.blender.org/api/current/bpy.types.BlendData.html?highlight=node_groups#bpy.types.BlendData.node_groups"><code>bpy.types.BlendData.node_groups</code></a> である。 ここで、なんとなく<code>bpy.data</code>を見てみると<code>bpy.data.node_groups</code>に追加されてることがわかる。</p>
<details>
<summary>`bpy.data.node_groups`までたどり着く道のりメモ(でもよくわからなくて落書き)</summary>
`data_to`は[`bpy.data.libraries.load`](https://docs.blender.org/api/current/bpy.types.BlendDataLibraries.html#bpy.types.BlendDataLibraries.load)から返されている。
`bpy.data`が[`BlendData`](https://docs.blender.org/api/current/bpy.types.BlendData.html)のインスタンスであることから
`bpy.data.libraries.load`は[`BlendDataLibraries.load`](https://docs.blender.org/api/current/bpy.types.BlendDataLibraries.html#bpy.types.BlendDataLibraries.load)である。  

...で、なんとなく`bpy.data`を見る、に戻る
</details>
<p><code>node_groups</code>の中で入力を受け付けてるものなら<code>.inputs</code>にある。 今回でいうと、<code>MToon</code>マテリアルにある<code>NomalmapTexture</code>というtypoを直したいので、 <code>bpy.data.node_groups['MToon_unversioned'].input['NomalmapTexture']</code>を参照する</p>
<h1 id="今行き詰まっている問題">今行き詰まっている問題</h1>
<h2 id="bpypropcollectionに追加できない">bpy<em>prop</em>collectionに追加できない</h2>
<p>これをtypoが直った<code>bpy.data.node_groups['MToon_unversioned'].input['NormalmapTexture']</code>に変えたいのだけど、 どうやら<code>input['NomalmapTexture']</code>の型である<code>bpy_prop_collection</code>がC実装なようで、普段のpythonのようにはいかない。 具体的にいうと</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>bpy.data.node_groups[<span class="st">&#39;MToon_unversioned&#39;</span>].<span class="bu">input</span>[<span class="st">&#39;NormalmapTexture&#39;</span>] <span class="op">=</span> bpy.data.node_groups[<span class="st">&#39;MToon_unversioned&#39;</span>].<span class="bu">input</span>[<span class="st">&#39;NomalmapTexture&#39;</span>]</span></code></pre></div>
</div>
<p>では以下のようにエラーを吐かれてうまくいかない。</p>
<div class="ui segment">
<div class="ui top right attached label">
python-repl
</div>
<pre class="python-repl SourceCode"><code>&gt;&gt;&gt; mtonNode = bpy.data.node_groups[&#39;MToon_unversioned&#39;]
&gt;&gt;&gt; mtoonNode.inputs[&#39;NormalmapTexture&#39;] = mtoonNode.inputs[&#39;NomalmapTexture&#39;]
Traceback (most recent call last):
  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
TypeError: bpy_prop_collection[key]: invalid key, must be a string or an int, not str</code></pre>
</div>
<h3 id="試したこと">試したこと</h3>
<p><a href="https://docs.blender.org/api/current/bpy.types.bpy_prop_collection.html?highlight=bpy_prop_collection#bpy.types.bpy_prop_collection"><code>bpy_prop_collection</code></a>のドキュメントと<code>dir(mtoonNode.inputs[0])</code>を読んでみた所、 ドキュメントには書かれていなかったけど<code>move</code>と<code>new</code>があった。</p>
<div class="ui segment">
<div class="ui top right attached label">
python-repl
</div>
<pre class="python-repl SourceCode"><code>&gt;&gt;&gt; dir(mtoonNode.inputs)
[&#39;__bool__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__delitem__&#39;, &#39;__doc__&#39;
, &#39;__doc__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__iter__&#39;, &#39;__len__&#39;
, &#39;__module__&#39;, &#39;__setattr__&#39;, &#39;__setitem__&#39;, &#39;__slots__&#39;, &#39;bl_rna&#39;
, &#39;clear&#39;, &#39;find&#39;, &#39;foreach_get&#39;, &#39;foreach_set&#39;, &#39;get&#39;
, &#39;items&#39;, &#39;keys&#39;, &#39;move&#39;, &#39;new&#39;, &#39;remove&#39;, &#39;rna_type&#39;, &#39;values&#39;]</code></pre>
</div>
<p>それぞれの挙動を試してみたが、どっちもうまく動かず...というか挙動がわからなかった</p>
<h4 id="new()"><code>new()</code></h4>
<details> <summary>Replの結果ですが長いので折りたたみ</summary>
``` python-repl
>>> mtoonNode.inputs
bpy.data...inputs
>>> mtoonNode
bpy.data.node_groups['MToon_unversioned']
>>> mtoonNode.inputs.new
<bpy_func NodeTreeInputs.new()>
>>> mtoonNode.inputs.new()
Traceback (most recent call last):
  File "<console>", line 1, in <module>
TypeError: NodeTreeInputs.new(): required parameter "type" not specified
>>> # mtoonNode.inputs['NomalmapTexture']から値を拝借
>>> mtoonNode.inputs.new('RGBA')
Traceback (most recent call last):
  File "<console>", line 1, in <module>
TypeError: NodeTreeInputs.new(): required parameter "name" not specified
>>> mtoonNode.inputs.new('RGBA', 'NormalmapTexture')
>>> mtoonNode.inputs
bpy.data...inputs
>>> mtoonNode.inputs['NormalmapTexture']
Traceback (most recent call last):
  File "<console>", line 1, in <module>
KeyError: 'bpy_prop_collection[key]: key "NormalmapTexture" not found'
>>> mtoonNode.inputs.items()
[('MainTexture', bpy.data...inputs[0])
, ('MainTextureAlpha', bpy.data...inputs[1])
, ('ShadeTexture', bpy.data...inputs[2])
, ('ReceiveShadow_Texture_alpha', bpy.data...inputs[3])
, ('NomalmapTexture', bpy.data...inputs[4])
, ('ShadingGradeTexture', bpy.data...inputs[5])
, ('Emission_Texture', bpy.data...inputs[6])
, ('SphereAddTexture', bpy.data...inputs[7])
, ('OutlineWidthTexture', bpy.data...inputs[8])
, ('UV_Animation_Mask_Texture', bpy.data...inputs[9])
, ('DiffuseColor', bpy.data...inputs[10])
, ('ShadeColor', bpy.data...inputs[11])
, ('EmissionColor', bpy.data...inputs[12])
, ('OutlineColor', bpy.data...inputs[13])
, ('RimColor', bpy.data...inputs[14])
, ('RimTexture', bpy.data...inputs[15])
, ('RimLightingMix', bpy.data...inputs[16])
, ('RimFresnelPower', bpy.data...inputs[17])
, ('RimLift', bpy.data...inputs[18])
, ('CutoffRate', bpy.data...inputs[19])
, ('BumpScale', bpy.data...inputs[20])
, ('ReceiveShadowRate', bpy.data...inputs[21])
, ('ShadeShift', bpy.data...inputs[22])
, ('ShadeToony', bpy.data...inputs[23])
, ('ShadingGradeRate', bpy.data...inputs[24])
, ('LightColorAttenuation', bpy.data...inputs[25])
, ('IndirectLightIntensity', bpy.data...inputs[26])
, ('OutlineWidth', bpy.data...inputs[27])
, ('OutlineScaleMaxDistance', bpy.data...inputs[28])
, ('OutlineLightingMix', bpy.data...inputs[29])
, ('OutlineWidthMode', bpy.data...inputs[30])
, ('OutlineColorMode', bpy.data...inputs[31])
, ('UV_Scroll_X', bpy.data...inputs[32])
, ('UV_Scroll_Y', bpy.data...inputs[33])
, ('UV_Scroll_Rotation', bpy.data...inputs[34])]
```
</details>
<h4 id="move()">move()</h4>
<details> <summary> Replの結果。長いため折りたたみ。 </summary>
``` python-repl
>>> mtoonNode.inputs.move()
Traceback (most recent call last):
  File "<console>", line 1, in <module>
TypeError: NodeTreeInputs.move(): required parameter "from_index" not specified
>>> mtoonNode.inputs.move(4)
Traceback (most recent call last):
  File "<console>", line 1, in <module>
TypeError: NodeTreeInputs.move(): required parameter "to_index" not specified
>>> mtoonNode.inputs.move(4, 35)
>>> mtoonNode.inputs.items()
[('MainTexture', bpy.data...inputs[0]), ('MainTextureAlpha', bpy.data...inputs[1])
, ('ShadeTexture', bpy.data...inputs[2])
, ('ReceiveShadow_Texture_alpha', bpy.data...inputs[3])
, ('NomalmapTexture', bpy.data...inputs[4])
, ('ShadingGradeTexture', bpy.data...inputs[5])
, ('Emission_Texture', bpy.data...inputs[6])
, ('SphereAddTexture', bpy.data...inputs[7])
, ('OutlineWidthTexture', bpy.data...inputs[8])
, ('UV_Animation_Mask_Texture', bpy.data...inputs[9])
, ('DiffuseColor', bpy.data...inputs[10])
, ('ShadeColor', bpy.data...inputs[11])
, ('EmissionColor', bpy.data...inputs[12])
, ('OutlineColor', bpy.data...inputs[13])
, ('RimColor', bpy.data...inputs[14])
, ('RimTexture', bpy.data...inputs[15])
, ('RimLightingMix', bpy.data...inputs[16])
, ('RimFresnelPower', bpy.data...inputs[17])
, ('RimLift', bpy.data...inputs[18])
, ('CutoffRate', bpy.data...inputs[19])
, ('BumpScale', bpy.data...inputs[20])
, ('ReceiveShadowRate', bpy.data...inputs[21])
, ('ShadeShift', bpy.data...inputs[22])
, ('ShadeToony', bpy.data...inputs[23])
, ('ShadingGradeRate', bpy.data...inputs[24])
, ('LightColorAttenuation', bpy.data...inputs[25])
, ('IndirectLightIntensity', bpy.data...inputs[26])
, ('OutlineWidth', bpy.data...inputs[27])
, ('OutlineScaleMaxDistance', bpy.data...inputs[28])
, ('OutlineLightingMix', bpy.data...inputs[29])
, ('OutlineWidthMode', bpy.data...inputs[30])
, ('OutlineColorMode', bpy.data...inputs[31])
, ('UV_Scroll_X', bpy.data...inputs[32])
, ('UV_Scroll_Y', bpy.data...inputs[33])
, ('UV_Scroll_Rotation', bpy.data...inputs[34])]
>>> mtoonNode.inputs.values()
[bpy.data...inputs[0]
, bpy.data...inputs[1], bpy.data...inputs[2]
, bpy.data...inputs[3], bpy.data...inputs[4]
, bpy.data...inputs[5], bpy.data...inputs[6]
, bpy.data...inputs[7], bpy.data...inputs[8]
, bpy.data...inputs[9], bpy.data...inputs[10]
, bpy.data...inputs[11], bpy.data...inputs[12]
, bpy.data...inputs[13], bpy.data...inputs[14]
, bpy.data...inputs[15], bpy.data...inputs[16]
, bpy.data...inputs[17], bpy.data...inputs[18]
, bpy.data...inputs[19], bpy.data...inputs[20]
, bpy.data...inputs[21], bpy.data...inputs[22]
, bpy.data...inputs[23], bpy.data...inputs[24]
, bpy.data...inputs[25], bpy.data...inputs[26]
, bpy.data...inputs[27], bpy.data...inputs[28]
, bpy.data...inputs[29], bpy.data...inputs[30]
, bpy.data...inputs[31], bpy.data...inputs[32]
, bpy.data...inputs[33], bpy.data...inputs[34]]
>>> bpy.data...inputs[1]
  File "<console>", line 1
    bpy.data...inputs[1]
              ^
SyntaxError: invalid syntax
>>>
```
</details>
]]></summary>
</entry>
<entry>
    <title>pythonのelifはifよりも速いのか</title>
    <link href="https://cj-bc.github.io/blog/posts/2020-11-07-python-is-elif-faster-than-ifs.html" />
    <id>https://cj-bc.github.io/blog/posts/2020-11-07-python-is-elif-faster-than-ifs.html</id>
    <published>2020-11-07T00:00:00Z</published>
    <updated>2020-11-07T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>pythonのelifはifよりも速いのか</h1>
  <div class="ui list">
    <div class="item">Posted on November  7, 2020</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on November  7, 2020
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a><a title="All pages tagged &#39;検証&#39;." href="/tags/%E6%A4%9C%E8%A8%BC.html" class="ui tag label">検証</a>
  
</div>

<p>一つの変数に対して、複数の条件で分岐させたい時時、大抵は<code>elif</code>を使って以下のように書くと思います。</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="cf">if</span> n <span class="op">==</span> <span class="st">&quot;A&quot;</span>:</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    ...</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="cf">elif</span> n <span class="op">==</span> <span class="st">&quot;B&quot;</span>:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    ...</span></code></pre></div>
</div>
<p>しかし、全ての場合ではありませんがこの場合はif文の羅列で書くこともできます。</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="cf">if</span> n <span class="op">==</span> <span class="st">&quot;A&quot;</span>:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    ...</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="cf">if</span> n <span class="op">==</span> <span class="st">&quot;B&quot;</span>:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    ...</span></code></pre></div>
</div>
<p>直感的に、nの値によってはelifの方がif文の実行回数が少なくなるため速そうに思えますが、本当にそうなのか気になったので試してみます。</p>
<h1 id="tl;dr">tl;dr</h1>
<p>速いぽい</p>
<h1 id="条件">条件</h1>
<p>pythonは3.7.4、if文の中身が同じものだと最適化がかかったりしないか怖かったのでそれぞれ違う出力をするprint文を入れます。 elifの数は適当に多めにしておきました。 また、1000回実行した平均の速度を表示するようにしました。</p>
<h1 id="測定に使ったコード">測定に使ったコード</h1>
<p>長いので</p>
<details><summary>測定コード</summary>
```
import time

a = 100

# without elif {{{
def f_without_elif():
    if a < 10:
        print("10")
    if 10 <= a < 20:
        print("20")
    if 20 <= a < 30:
        print("30")
    if 30 <= a < 40:
        print("40")
    if 40 <= a < 50:
        print("50")
    if 50 <= a < 60:
        print("60")
    if 60 <= a < 70:
        print("70")
    if 70 <= a < 80:
        print("80")
    if 80 <= a < 90:
        print("90")
    if 90 <= a < 100:
        print("100")
    if 100 <= a < 110:
        print("110")
    if 110 <= a < 120:
        print("120")
    if 120 <= a < 130:
        print("130")
    if 130 <= a < 140:
        print("140")
    if 140 <= a < 150:
        print("150")
    if 150 <= a < 160:
        print("160")
    if 160 <= a < 170:
        print("170")
    if 170 <= a < 180:
        print("180")
    if 180 <= a < 190:
        print("190")
    if 190 <= a < 200:
        print("200")
    if 200 <= a < 210:
        print("210")
    if 210 <= a < 220:
        print("220")
    if 220 <= a < 230:
        print("230")
    if 230 <= a < 240:
        print("240")
    if 240 <= a < 250:
        print("250")
    if 250 <= a < 260:
        print("260")
    if 260 <= a < 270:
        print("270")
    if 270 <= a < 280:
        print("280")
    if 280 <= a < 290:
        print("290")
    if 290 <= a < 300:
        print("300")
    if 300 <= a < 310:
        print("310")
    if 310 <= a < 320:
        print("320")
    if 320 <= a < 330:
        print("330")
    if 330 <= a < 340:
        print("340")
    if 340 <= a < 350:
        print("350")
    if 350 <= a < 360:
        print("360")
    if 360 <= a < 370:
        print("370")
    if 370 <= a < 380:
        print("380")
    if 380 <= a < 390:
        print("390")
    if 390 <= a < 400:
        print("400")
    if 400 <= a < 410:
        print("410")
    if 410 <= a < 420:
        print("420")
    if 420 <= a < 430:
        print("430")
    if 430 <= a < 440:
        print("440")
    if 440 <= a < 450:
        print("450")
    if 450 <= a < 460:
        print("460")
    if 460 <= a < 470:
        print("470")
    if 470 <= a < 480:
        print("480")
    if 480 <= a < 490:
        print("490")
    if 490 <= a < 500:
        print("500")
    if 500 <= a < 510:
        print("510")
    if 510 <= a < 520:
        print("520")
    if 520 <= a < 530:
        print("530")
    if 530 <= a < 540:
        print("540")
    if 540 <= a < 550:
        print("550")
    if 550 <= a < 560:
        print("560")
    if 560 <= a < 570:
        print("570")
    if 570 <= a < 580:
        print("580")
    if 580 <= a < 590:
        print("590")
    if 590 <= a < 600:
        print("600")
    if 600 <= a < 610:
        print("610")
    if 610 <= a < 620:
        print("620")
    if 620 <= a < 630:
        print("630")
    if 630 <= a < 640:
        print("640")
    if 640 <= a < 650:
        print("650")
    if 650 <= a < 660:
        print("660")
    if 660 <= a < 670:
        print("670")
    if 670 <= a < 680:
        print("680")
    if 680 <= a < 690:
        print("690")
    if 690 <= a < 700:
        print("700")
    if 700 <= a < 710:
        print("710")
    if 710 <= a < 720:
        print("720")
    if 720 <= a < 730:
        print("730")
    if 730 <= a < 740:
        print("740")
    if 740 <= a < 750:
        print("750")
    if 750 <= a < 760:
        print("760")
    if 760 <= a < 770:
        print("770")
    if 770 <= a < 780:
        print("780")
    if 780 <= a < 790:
        print("790")
    if 790 <= a < 800:
        print("800")
    if 800 <= a < 810:
        print("810")
    if 810 <= a < 820:
        print("820")
    if 820 <= a < 830:
        print("830")
    if 830 <= a < 840:
        print("840")
    if 840 <= a < 850:
        print("850")
    if 850 <= a < 860:
        print("860")
    if 860 <= a < 870:
        print("870")
    if 870 <= a < 880:
        print("880")
    if 880 <= a < 890:
        print("890")
    if 890 <= a < 900:
        print("900")
    if 900 <= a < 910:
        print("910")
    if 910 <= a < 920:
        print("920")
    if 920 <= a < 930:
        print("930")
    if 930 <= a < 940:
        print("940")
    if 940 <= a < 950:
        print("950")
    if 950 <= a < 960:
        print("960")
    if 960 <= a < 970:
        print("970")
    if 970 <= a < 980:
        print("980")
    if 980 <= a < 990:
        print("990")
    if 990 <= a < 1000:
        print("1000")
    if 1000 <= a < 1010:
        print("1010")
    if 1010 <= a < 1020:
        print("1020")
    if 1020 <= a < 1030:
        print("1030")
    if 1030 <= a < 1040:
        print("1040")
    if 1040 <= a < 1050:
        print("1050")
    if 1050 <= a < 1060:
        print("1060")
    if 1060 <= a < 1070:
        print("1070")
# }}}


# with elif {{{
def f_with_elif():
    if a < 10:
        print("10")
    elif 10 <= a < 20:
        print("20")
    elif 20 <= a < 30:
        print("30")
    elif 30 <= a < 40:
        print("40")
    elif 40 <= a < 50:
        print("50")
    elif 50 <= a < 60:
        print("60")
    elif 60 <= a < 70:
        print("70")
    elif 70 <= a < 80:
        print("80")
    elif 80 <= a < 90:
        print("90")
    elif 90 <= a < 100:
        print("100")
    elif 100 <= a < 110:
        print("110")
    elif 110 <= a < 120:
        print("120")
    elif 120 <= a < 130:
        print("130")
    elif 130 <= a < 140:
        print("140")
    elif 140 <= a < 150:
        print("150")
    elif 150 <= a < 160:
        print("160")
    elif 160 <= a < 170:
        print("170")
    elif 170 <= a < 180:
        print("180")
    elif 180 <= a < 190:
        print("190")
    elif 190 <= a < 200:
        print("200")
    elif 200 <= a < 210:
        print("210")
    elif 210 <= a < 220:
        print("220")
    elif 220 <= a < 230:
        print("230")
    elif 230 <= a < 240:
        print("240")
    elif 240 <= a < 250:
        print("250")
    elif 250 <= a < 260:
        print("260")
    elif 260 <= a < 270:
        print("270")
    elif 270 <= a < 280:
        print("280")
    elif 280 <= a < 290:
        print("290")
    elif 290 <= a < 300:
        print("300")
    elif 300 <= a < 310:
        print("310")
    elif 310 <= a < 320:
        print("320")
    elif 320 <= a < 330:
        print("330")
    elif 330 <= a < 340:
        print("340")
    elif 340 <= a < 350:
        print("350")
    elif 350 <= a < 360:
        print("360")
    elif 360 <= a < 370:
        print("370")
    elif 370 <= a < 380:
        print("380")
    elif 380 <= a < 390:
        print("390")
    elif 390 <= a < 400:
        print("400")
    elif 400 <= a < 410:
        print("410")
    elif 410 <= a < 420:
        print("420")
    elif 420 <= a < 430:
        print("430")
    elif 430 <= a < 440:
        print("440")
    elif 440 <= a < 450:
        print("450")
    elif 450 <= a < 460:
        print("460")
    elif 460 <= a < 470:
        print("470")
    elif 470 <= a < 480:
        print("480")
    elif 480 <= a < 490:
        print("490")
    elif 490 <= a < 500:
        print("500")
    elif 500 <= a < 510:
        print("510")
    elif 510 <= a < 520:
        print("520")
    elif 520 <= a < 530:
        print("530")
    elif 530 <= a < 540:
        print("540")
    elif 540 <= a < 550:
        print("550")
    elif 550 <= a < 560:
        print("560")
    elif 560 <= a < 570:
        print("570")
    elif 570 <= a < 580:
        print("580")
    elif 580 <= a < 590:
        print("590")
    elif 590 <= a < 600:
        print("600")
    elif 600 <= a < 610:
        print("610")
    elif 610 <= a < 620:
        print("620")
    elif 620 <= a < 630:
        print("630")
    elif 630 <= a < 640:
        print("640")
    elif 640 <= a < 650:
        print("650")
    elif 650 <= a < 660:
        print("660")
    elif 660 <= a < 670:
        print("670")
    elif 670 <= a < 680:
        print("680")
    elif 680 <= a < 690:
        print("690")
    elif 690 <= a < 700:
        print("700")
    elif 700 <= a < 710:
        print("710")
    elif 710 <= a < 720:
        print("720")
    elif 720 <= a < 730:
        print("730")
    elif 730 <= a < 740:
        print("740")
    elif 740 <= a < 750:
        print("750")
    elif 750 <= a < 760:
        print("760")
    elif 760 <= a < 770:
        print("770")
    elif 770 <= a < 780:
        print("780")
    elif 780 <= a < 790:
        print("790")
    elif 790 <= a < 800:
        print("800")
    elif 800 <= a < 810:
        print("810")
    elif 810 <= a < 820:
        print("820")
    elif 820 <= a < 830:
        print("830")
    elif 830 <= a < 840:
        print("840")
    elif 840 <= a < 850:
        print("850")
    elif 850 <= a < 860:
        print("860")
    elif 860 <= a < 870:
        print("870")
    elif 870 <= a < 880:
        print("880")
    elif 880 <= a < 890:
        print("890")
    elif 890 <= a < 900:
        print("900")
    elif 900 <= a < 910:
        print("910")
    elif 910 <= a < 920:
        print("920")
    elif 920 <= a < 930:
        print("930")
    elif 930 <= a < 940:
        print("940")
    elif 940 <= a < 950:
        print("950")
    elif 950 <= a < 960:
        print("960")
    elif 960 <= a < 970:
        print("970")
    elif 970 <= a < 980:
        print("980")
    elif 980 <= a < 990:
        print("990")
    elif 990 <= a < 1000:
        print("1000")
    elif 1000 <= a < 1010:
        print("1010")
    elif 1010 <= a < 1020:
        print("1020")
    elif 1020 <= a < 1030:
        print("1030")
    elif 1030 <= a < 1040:
        print("1040")
    elif 1040 <= a < 1050:
        print("1050")
    elif 1050 <= a < 1060:
        print("1060")
    elif 1060 <= a < 1070:
        print("1070")
# }}}



t_start = time.time()
for _ in range(1000):
    f_without_elif()
t_end   = time.time()
print(f"without elif: {(t_end - t_start)/1000} sec")

t_with_elif_start = time.time()
for _ in range(1000):
    f_with_elif()
t_with_elif_end   = time.time()
print(f"with elif   : {(t_with_elif_end - t_with_elif_start)/1000} sec")
```
</details>
<h1 id="結果">結果</h1>
<p><code>print</code>でたくさん標準出力を使っていますが、 そこの値は重要ではないので 私は<a href="https://github.com/thinca/vim-quickrun">quickrun</a>を使って vim上のバッファで加工して消しています</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>without elif: 4.281997680664063e-06 sec
with elif   : 9.88006591796875e-07 sec</code></pre>
</div>
<p>一瞬遅くなって見えますが、桁が一桁違います。少数表記にすると</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>without elif: 0.000004 sec
with elif   : 0.000001 sec</code></pre>
</div>
<p>となり、<code>elif</code>の方が速いことがわかります。</p>
<h1 id="考察">考察</h1>
<p>なぜ速いのかを考えてみます。</p>
<h2 id="構文木">構文木</h2>
<p><code>elif</code>には特別なノードがなく、構文木に落とすと親の<code>If</code>ノードの<code>oreelse</code>に含まれる<code>If</code>ノードになります。</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="im">import</span> ast</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="bu">print</span>(ast.dump(ast.parse(<span class="st">&quot;&quot;&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="st">if x:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="st">   ...</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="st">elif y:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="st">   ...</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="st">else:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="st">   ...</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a><span class="st">if z:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a><span class="st">    ...</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="st">&quot;&quot;&quot;</span>)))</span></code></pre></div>
</div>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>Module(
    body=[
        If(test=Name(id=&#39;x&#39;, ctx=Load()),
           body=[Expr(value=Ellipsis())],
           orelse=[
              If(test=Name(id=&#39;y&#39;, ctx=Load()),
                 body=[Expr(value=Ellipsis())],
                 orelse=[Expr(value=Ellipsis())])
              ]
          ),
        If(test=Name(id=&#39;z&#39;, ctx=Load()),
           body=[Expr(value=Ellipsis())],
           orelse=[])
        ]
)</code></pre>
</div>
<p>https://docs.python.org/ja/3/library/ast.html?highlight=elif#ast.If</p>
<h2 id="ステップ数を調べる">ステップ数を調べる</h2>
<p>おそらく、if文が実行される回数が少ないはず、なのでpythonのデバッガである<a href="https://docs.python.org/3/library/pdb.html">pdb</a>を使って調べてみます。</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>&gt;&gt;&gt; # まずはelif使わないもの
&gt;&gt;&gt; pdb.run(&quot;&quot;&quot;
    ... if True:
    ...     print(&quot;s&quot;)
    ... if False:
    ...     print(&quot;f&quot;)
    ... &quot;&quot;&quot;)
&gt; &lt;string&gt;(3)&lt;module&gt;()-&gt;None
(Pdb) n
s
&gt; &lt;string&gt;(4)&lt;module&gt;()-&gt;None
(Pdb)
--Return--
&gt; &lt;string&gt;(4)&lt;module&gt;()-&gt;None
(Pdb)
&gt;&gt;&gt; pdb.run(&quot;&quot;&quot;
    ... if True:
    ...     print(&quot;s&quot;)
    ... elif False:
    ...     print(&quot;f&quot;)
    ... &quot;&quot;&quot;)
&gt; &lt;string&gt;(3)&lt;module&gt;()-&gt;None
(Pdb) n
s
--Return--
&gt; &lt;string&gt;(3)&lt;module&gt;()-&gt;None
(Pdb)
&gt;&gt;&gt;</code></pre>
</div>
<p>やはり、<code>if</code>文を分割した場合と比べて<code>elif</code>の方が"--Return--"が早く来ていますね。 これひとつではそこまで差異はないと思いますが、もっと複雑な条件式を使っている場合や何度も重なっている場合は影響が出そうですね。</p>
]]></summary>
</entry>
<entry>
    <title>簡易的な素数探索アルゴリズムの速度比較</title>
    <link href="https://cj-bc.github.io/blog/posts/2020-10-17-comparing-primes-algorithm.html" />
    <id>https://cj-bc.github.io/blog/posts/2020-10-17-comparing-primes-algorithm.html</id>
    <published>2020-10-17T00:00:00Z</published>
    <updated>2020-10-17T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>簡易的な素数探索アルゴリズムの速度比較</h1>
  <div class="ui list">
    <div class="item">Posted on October 17, 2020</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on October 17, 2020
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a><a title="All pages tagged &#39;アルゴリズム&#39;." href="/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0.html" class="ui tag label">アルゴリズム</a>
  
</div>

<p>いや簡単なものなのですが個人的なメモ。 実行言語は<code>python 3.7.4</code>です。</p>
<h1 id="比較するアルゴリズム">比較するアルゴリズム</h1>
<h1 id="1. 定義通りの求め方">1. 定義通りの求め方</h1>
<p>素数は「自分自身と1のみを約数に持つ数」なので、「自分自身と1以外に割り切れる数があるか」を調べれば素数かの判定ができることになります。</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">def</span> fromDefinition(nums: [<span class="bu">int</span>]) <span class="op">-&gt;</span> [<span class="bu">int</span>]:</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="kw">def</span> f(n: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>      <span class="cf">if</span> n <span class="op">%</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>      <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>    <span class="cf">return</span> <span class="bu">list</span>(<span class="bu">filter</span>(f, nums))</span></code></pre></div>
</div>
<h2 id="エラトステネスの揮">エラトステネスの揮</h2>
<p>多分中学校かそこらへんで習ったであろう方法。 求めたい範囲の数の集合から、小さい素数の倍数をふるい落としていく方法です。<br />
<a href="https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%A9%E3%83%88%E3%82%B9%E3%83%86%E3%83%8D%E3%82%B9%E3%81%AE%E7%AF%A9">wikipediaの図解</a>がわかりやすい。</p>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="im">import</span> time</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="kw">def</span> eratosthenes(nums: [<span class="bu">int</span>]) <span class="op">-&gt;</span> [<span class="bu">int</span>]:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>    <span class="cf">if</span> nums[<span class="dv">0</span>] <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        <span class="cf">return</span> eratosthenes(nums[<span class="dv">1</span>:])</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>    head <span class="op">=</span> nums[<span class="dv">0</span>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>    <span class="cf">if</span> head <span class="op">&gt;=</span> sqrt(nums[<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>        <span class="cf">return</span> nums</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>    ret <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> i: i <span class="op">%</span> head <span class="op">!=</span> <span class="dv">0</span>, nums))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>    <span class="cf">return</span> [head] <span class="op">+</span> eratosthenes(ret)</span></code></pre></div>
</div>
<h1 id="実行時間計測">実行時間計測</h1>
<p>それぞれの処理を1000回ずつ実行し、その平均を求めた</p>
<h2 id="計測用コード">計測用コード</h2>
<div class="ui segment">
<div class="ui top right attached label">
python
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python SourceCode"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">def</span> mesureTime(f, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    startTime <span class="op">=</span> time.time()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    f(<span class="op">*</span>args)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    <span class="cf">return</span> time.time() <span class="op">-</span> startTime</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="kw">def</span> mesureTimeAvr(f, <span class="op">*</span>args) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>    t <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>        t<span class="op">+=</span>mesureTime(f, <span class="op">*</span>args)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>    <span class="cf">return</span> t <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>x <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">100</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="bu">print</span>(<span class="ss">f&quot;fromDefinition: </span><span class="sc">{</span>mesureTimeAvr(fromDefinition, x)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a><span class="bu">print</span>(<span class="ss">f&quot;eratosthenes  : </span><span class="sc">{</span>mesureTimeAvr(eratosthenes, x)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
<h2 id="結果">結果</h2>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>fromDefinition: 3.378009796142578e-05
eratosthenes  : 2.4552106857299804e-05</code></pre>
</div>
<p>エラトステネスの揮の方が1秒くらい早い。 Orderはわからん！！</p>
]]></summary>
</entry>
<entry>
    <title>jupyter notebookがうまく起動しなかった</title>
    <link href="https://cj-bc.github.io/blog/posts/2020-10-08-jupyter-notebook-doesnt-up-so-long.html" />
    <id>https://cj-bc.github.io/blog/posts/2020-10-08-jupyter-notebook-doesnt-up-so-long.html</id>
    <published>2020-10-10T00:00:00Z</published>
    <updated>2020-10-10T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="ui center aligned icon header">
  <h1>jupyter notebookがうまく起動しなかった</h1>
  <div class="ui list">
    <div class="item">Posted on October 10, 2020</div>
    <div class="item">
      <i class="history icon"></i>
      Updated on October 17, 2020
    </div>
  </div>
    
</div>
<div class="info">
  
  <a title="All pages tagged &#39;python&#39;." href="/tags/python.html" class="ui tag label">python</a><a title="All pages tagged &#39;jupyter&#39;." href="/tags/jupyter.html" class="ui tag label">jupyter</a><a title="All pages tagged &#39;macOS&#39;." href="/tags/macOS.html" class="ui tag label">macOS</a>
  
</div>

<div class="ui segment">
<div class="ui top right attached label">
sh
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh SourceCode"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>$ <span class="ex">jupyter</span> notebook</span></code></pre></div>
</div>
<p>だと、鯖は立ち上がるもののページが読み込めずうまくいかなかった。 試しに、<a href="https://qiita.com/ciela/items/0e0392f600c92b93d7c6">この記事</a>に従ってみたところ接続できた。 よくわからないけど、まぁ動いたのでよし。別段VM環境でもなかったんだけどなぁ</p>
<div class="ui segment">
<div class="ui top right attached label">
sh
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh SourceCode"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>$ <span class="ex">jupyter</span> notebook --ip=<span class="dt">\*</span></span></code></pre></div>
</div>
]]></summary>
</entry>

</feed>
