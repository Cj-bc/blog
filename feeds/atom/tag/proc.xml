<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>CLI! CLI! CLI!</title>
    <link href="https://cj-bc.github.io/blog/feeds/atom/tag/proc.xml" rel="self" />
    <link href="https://cj-bc.github.io/blog" />
    <id>https://cj-bc.github.io/blog/feeds/atom/tag/proc.xml</id>
    <author>
        <name>Cj-bc a.k.a Cj.BC_SD</name>
        <email>cj.bc-sd@outlook.jp</email>
    </author>
    <updated>2022-03-18T00:00:00Z</updated>
    <entry>
    <title>2022-03-18-gpg-stuggled-to-search-key-from-keyserver</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-18-gpg-stuggled-to-search-key-from-keyserver.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-18-gpg-stuggled-to-search-key-from-keyserver.html</id>
    <published>2022-03-18T00:00:00Z</published>
    <updated>2022-03-18T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>gpg --search-keys がうまくいかなかったので調べる</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 18, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 18, 2022
	</div>

	

	
	<a title="All pages tagged &#39;gpg&#39;." href="/tags/gpg.html" class="ui tag label">gpg</a>
	
      </div>

    <div class="description">
      <h1 id="状況">状況</h1>
<p>stackの署名キーを引いてくるために、 <code>--search-keywords</code> を してみたところエラーが起きた。</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb1" data-org-language="sh"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gpg</span> <span class="at">--search-keys</span> 65101FF31C5C154D</span></code></pre></div>
</div>
<p>gpg: error searching keyserver: Server indicated a failure gpg: keyserver search failed: Server indicated a failure</p>
<h1 id="原因: DNSリゾルバが適切に設定されていなかった">原因: DNSリゾルバが適切に設定されていなかった</h1>
<p>らしい。 <strong>systemd-resolvedを使用している場合</strong> 注意が必要そう。</p>
<p>具体的には、 <strong>GnuPGはドメイン名解決のために <code>/etc/resolv.conf</code> を参照するが systemd-resolvedは <code>/etc/resolv.conf</code> を参照も設定もしない</strong></p>
<p>なので、ドメイン名解決のための設定を何もしていない状況になっていた。</p>
<p>実は <a href="https://wiki.archlinux.jp/index.php/Systemd-resolved#DNS">archwikiのsystemd-resolvedページに記載がある</a>のでそれに従い、</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb2" data-org-language="sh"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 私の場合は元から /etc/resolve.conf が</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 空だったので削除しているが、必要に応じて</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># なんかして</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> /etc/resolv.conf</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf</span></code></pre></div>
</div>
<p>としてリンクを作成した。</p>
<p>この後 <code>gpgconf --reload</code> で設定を読み直したら動くようになった!</p>
<h1 id="過去の調べ物">過去の調べ物</h1>
<p>とりあえず色々調べたけど、 結論今回は関係なかったものたち。 まぁ状況によっては役立つかもなので残しておく。</p>
<h2 id="dirmngr 2.1.17時代のバグの話">dirmngr 2.1.17時代のバグの話</h2>
<p>これは無関係だった。dirmngrの昔のバージョンにて、 全ての操作が出来無いバグがあったらしい。わぁぉ。</p>
<ul>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=220996">https://bbs.archlinux.org/viewtopic.php?id=220996</a></li>
<li><a href="https://dev.gnupg.org/T2889">https://dev.gnupg.org/T2889</a></li>
</ul>
<h2 id="コードリーディングで原因探し">コードリーディングで原因探し</h2>
<p>とりあえずもうちょい確信に迫りたかったので、 えいやって <a href="https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=summary">gnupgのgitレポジトリ</a>cloneしてきて読んだ。</p>
<p><code>gpg --debug-all --search-keys &lt;key_id&gt;</code> が出力した エラーメッセージ "Try again later" をとりあえずgrepする。</p>
<p>けどみつからん。</p>
<p>実は実際は<a href="https://git.gnupg.org/cgi-bin/gitweb.cgi?p=libgpg-error.git;a=blob;f=src/err-codes.h.in;hb=32dad4e4135f0bdc436ed684da753d4b0cdb0ea1#l334">libgpg-error</a>の中にエラーメッセージが定義されており、 そちらを探すと以下のコードが見付かる。</p>
<div class="ui segment">
<div class="ui top right attached label">
c
</div>
<div class="sourceCode" id="src/err-codes.h.in:334"><pre class="sourceCode c SourceCode"><code class="sourceCode c"><span id="src/err-codes.h.in:334-1"><a href="#src/err-codes.h.in:334-1" aria-hidden="true" tabindex="-1"></a><span class="dv">312</span>     GPG_ERR_TRY_LATER               Try again later</span></code></pre></div>
</div>
<p>これだけだとわからないが、 <em>まぁ多分これ定数だろうという推測</em> のもと今度は <code>GPG_ERR_TRY_LATER</code> を(今度こそ) gnupgのコードベースで grepしてみる。 と、一箇所だけ見付かる:</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb3" data-org-language="sh" wrap="src c"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> . <span class="at">-regex</span> <span class="st">&#39;.*\.c\|.*\.h&#39;</span> <span class="at">-exec</span> grep <span class="st">&#39;GPG_ERR_TRY_LATER&#39;</span> {} <span class="dt">\+</span></span></code></pre></div>
</div>
<div class="ui segment">
<div class="ui top right attached label">
c
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode c SourceCode"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">./</span>dirmngr<span class="op">/</span>dns<span class="op">-</span>stuff<span class="op">.</span>c<span class="op">:</span>    <span class="cf">case</span> TRY_AGAIN<span class="op">:</span>      ec <span class="op">=</span> GPG_ERR_TRY_LATER<span class="op">;</span> <span class="cf">break</span><span class="op">;</span></span></code></pre></div>
</div>
<p>これは <code>get_h_errno_as_gpg_error</code> 関数であり、 説明によると <code>H_ERRNO</code> をgpgで使用されるエラーコードに直してくれるらしい。</p>
<p>…まぁとりあえず使用例を追う。と、 <a href="https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=dirmngr/dns-stuff.c;h=0edbc0442e05086c5785a2efb75292e526291319;hb=HEAD">dirmngr/dns-stuff.c</a>の中に2箇所あるがどちらも <code>res_query</code> を呼んだ結果によって使用されている。</p>
<div class="ui segment">
<div class="ui top right attached label">
c
</div>
<div class="sourceCode" id="getsrv_standard()"><pre class="sourceCode c SourceCode"><code class="sourceCode c"><span id="getsrv_standard()-1"><a href="#getsrv_standard()-1" aria-hidden="true" tabindex="-1"></a>     <span class="op">...</span></span>
<span id="getsrv_standard()-2"><a href="#getsrv_standard()-2" aria-hidden="true" tabindex="-1"></a>     r <span class="op">=</span> res_query <span class="op">(</span>name<span class="op">,</span> C_IN<span class="op">,</span> T_SRV<span class="op">,</span> answer<span class="op">,</span> <span class="kw">sizeof</span> res<span class="op">.</span>ans<span class="op">);</span></span>
<span id="getsrv_standard()-3"><a href="#getsrv_standard()-3" aria-hidden="true" tabindex="-1"></a>     my_protect <span class="op">();</span></span>
<span id="getsrv_standard()-4"><a href="#getsrv_standard()-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> <span class="op">(</span>r <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="getsrv_standard()-5"><a href="#getsrv_standard()-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> get_h_errno_as_gpg_error <span class="op">();</span></span>
<span id="getsrv_standard()-6"><a href="#getsrv_standard()-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="getsrv_standard()-7"><a href="#getsrv_standard()-7" aria-hidden="true" tabindex="-1"></a>     <span class="op">...</span></span></code></pre></div>
</div>
<div class="ui segment">
<div class="ui top right attached label">
c
</div>
<div class="sourceCode" id="get_dns_cname_standard()"><pre class="sourceCode c SourceCode"><code class="sourceCode c"><span id="get_dns_cname_standard()-1"><a href="#get_dns_cname_standard()-1" aria-hidden="true" tabindex="-1"></a>     <span class="op">...</span></span>
<span id="get_dns_cname_standard()-2"><a href="#get_dns_cname_standard()-2" aria-hidden="true" tabindex="-1"></a>     r <span class="op">=</span> res_query <span class="op">(</span>name<span class="op">,</span> C_IN<span class="op">,</span> T_CERT<span class="op">,</span> answer<span class="op">,</span> <span class="kw">sizeof</span> res<span class="op">.</span>ans<span class="op">);</span></span>
<span id="get_dns_cname_standard()-3"><a href="#get_dns_cname_standard()-3" aria-hidden="true" tabindex="-1"></a>     my_protect <span class="op">();</span></span>
<span id="get_dns_cname_standard()-4"><a href="#get_dns_cname_standard()-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> <span class="op">(</span>r <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="get_dns_cname_standard()-5"><a href="#get_dns_cname_standard()-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> get_h_errno_as_gpg_error <span class="op">();</span></span>
<span id="get_dns_cname_standard()-6"><a href="#get_dns_cname_standard()-6" aria-hidden="true" tabindex="-1"></a>     <span class="op">...</span></span></code></pre></div>
</div>
<p>で、じゃぁこいつが何か…?と思ってgrepしてみると 定義がない。実はこいつはresolverで定義されており、manページを 引くことができる<a href="https://man.archlinux.org/man/res_query.3">res<sub>query</sub>(3)</a></p>
<p>Cだとこういうのたまに見掛けるので面白いね。</p>
<p>で、芋蔓式にわかるのだけれど <code>h_errno</code> も <a href="https://man.archlinux.org/man/gethostbyname.3">gethostbyname(3)</a>に定義されている。</p>
<p>なので、あとはそこを追えばよさそう!!!</p>
<p>…なのだけど、この段階になって先に述べた解決方法が 判明してしまったのでここまでで打ち切り。</p>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-17</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-17.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-17.html</id>
    <published>2022-03-17T00:00:00Z</published>
    <updated>2022-03-17T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>2022/03/17</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 17, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 18, 2022
	</div>

	

	
	<a title="All pages tagged &#39;haskell&#39;." href="/tags/haskell.html" class="ui tag label">haskell</a><a title="All pages tagged &#39;stack&#39;." href="/tags/stack.html" class="ui tag label">stack</a><a title="All pages tagged &#39;archlinux&#39;." href="/tags/archlinux.html" class="ui tag label">archlinux</a>
	
      </div>

    <div class="description">
      <h1 id="やったこと">やったこと</h1>
<p>全体的には、家にいる間は <code>stack-static</code> にふりまわされてた</p>
<h2 id="stackを stack-static に変えようとしている">stackを <code>stack-static</code> に変えようとしている</h2>
<p>今迄stackは公式レポジトリのものを使っていたが、グローバルにhaskell パッケージを導入する必要があるのがちょっと嫌だった。</p>
<p>今朝、 <code>pacman -Syu</code> した所、依存パッケージの <code>haskell-cryptonite-conduit</code> の関係でstackが使えなくなった。</p>
<p>そもそもグローバルにインストールしてるのがあまり好きではないので、 Archlinux-jpで存在を教わった、AURの <code>stack-static</code> に変えようとしている…のだけど 結構てこずっている。</p>
<h2 id="yay -Sc"><code>yay -Sc</code></h2>
<p>容量空ける為に走らせたところ、空き容量2GB→8.5GBと大幅に増えた。 やったね!</p>
<h2 id="散歩した">散歩した</h2>
<p>散歩した。ついでに、お弁当を買って公園で御飯を食べるなどした。 前から気になってたお店で買ったのだけど、思った以上に美味しくてとてもハッピー…!</p>
<p>御飯食べて、近くにカフェがあったので珈琲買って飲んだ。 結構長いこと外におったな今日は。</p>
<h1 id="知ったこと">知ったこと</h1>
<h2 id="Archlinuxのパッケージが、pkgrelのみアップデートされている現象について">Archlinuxのパッケージが、pkgrelのみアップデートされている現象について</h2>
<p>Archlinux-jpで聞いた所リンクを貰った、まだ理解しきれてないのでとりあえずここに。</p>
<p><a href="https://www.reddit.com/r/archlinux/comments/7qtx37/why_do_haskellbased_software_upgrades_require_a/">https://www.reddit.com/r/archlinux/comments/7qtx37/why_do_haskellbased_software_upgrades_require_a/</a></p>
<h1 id="やること">やること</h1>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-14-org-mode-fix-clock-start-time-is-gone</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-14-org-mode-fix-clock-start-time-is-gone.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-14-org-mode-fix-clock-start-time-is-gone.html</id>
    <published>2022-03-14T00:00:00Z</published>
    <updated>2022-03-14T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>"Clock start time is gone" エラーを解消する</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 14, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 14, 2022
	</div>

	

	
	<a title="All pages tagged &#39;elisp&#39;." href="/tags/elisp.html" class="ui tag label">elisp</a><a title="All pages tagged &#39;emacs&#39;." href="/tags/emacs.html" class="ui tag label">emacs</a><a title="All pages tagged &#39;org-mode&#39;." href="/tags/org-mode.html" class="ui tag label">org-mode</a>
	
      </div>

    <div class="description">
      <p>Org captureから戻る時とか、たまに</p>
<div class="ui piled segment" style="z-index: 0">
<blockquote>
<p>Clock start time is gone</p>
</blockquote>
</div>
<p>とか言われて戻れないことがあります。 この時の対処法についてです。</p>
<h1 id="原因: org-clock-marker がずれている">原因: <code>org-clock-marker</code> がずれている</h1>
<p>これは珍しい事例なのでは？と思うのですが、 最後の <code class="verbatim">Clock-in</code> した場所を保持している <code>org-clock-marker</code> が ずれている場合があります。</p>
<p>このマーカーは、 <code>CLOCK: ~ 等の行の先頭に位置する必要がありますが、
   私の見た環境では ~:LOGBOOK:</code> の行に存在していました。 この場合、 <code class="verbatim">org-clock.el</code> の以下の部分で弾かれてエラーになってしまいます。</p>
<div class="ui segment">
<div class="ui top right attached label">
elisp
</div>
<pre class="elisp SourceCode"><code>  (if (and (looking-at (concat &quot;[ \t]*&quot; org-keyword-time-regexp))
(equal (match-string 1) org-clock-string))
  (setq ts (match-string 2))
(if fail-quietly (throw &#39;exit nil) (error &quot;Clock start time is gone&quot;)))
</code></pre>
</div>
<p>[[<a href="file:/usr/share/emacs/27.2/lisp/org/org-clock.el.gz">file:/usr/share/emacs/27.2/lisp/org/org-clock.el.gz</a>::if (and (looking-at (concat "<span class="math display">$$ \t$$</span>*" org-keyword-time-regexp)][source code(オフライン用)]]</p>
<h1 id="解決策: マーカーをずらす">解決策: マーカーをずらす</h1>
<p>凄く愚直ですがまぁ。 help:move-marker でマーカーを動かせるので、それを使用します。</p>
<p>マーカーは <code>CLOCK:</code> の行の最初にある必要があるので、まずはそこの 位置を調べる必要があります。 カーソルの位置を調べる方法は何かありそうではありますが、 今回はマーカーを置きたい位置にカーソルを置き、そこのtext Propertyを調べます。</p>
<div class="ui segment">
<div class="ui top right attached label">
elisp
</div>
<pre class="elisp SourceCode"><code>(describe-text-properties)
</code></pre>
</div>
<p>そうすると、以下のように表示されます。この場合位置は <code>1411</code> ということになります。</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>Text content at position 1411:


There are text properties here:
  fontified            t

[back]
</code></pre>
</div>
<p>で、その番号を <code>new-pt</code> と仮置きすると、</p>
<div class="ui segment">
<div class="ui top right attached label">
elisp
</div>
<pre class="elisp SourceCode"><code>(move-marker org-clock-marker new-pt)
</code></pre>
</div>
<p>で設定しなおせます。</p>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-14-linux-fix-audio-environments</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-14-linux-fix-audio-environments.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-14-linux-fix-audio-environments.html</id>
    <published>2022-03-14T00:00:00Z</published>
    <updated>2022-03-14T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>音声周りの環境改善をした</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 14, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 14, 2022
	</div>

	

	
	<a title="All pages tagged &#39;archlinux&#39;." href="/tags/archlinux.html" class="ui tag label">archlinux</a><a title="All pages tagged &#39;環境構築&#39;." href="/tags/%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89.html" class="ui tag label">環境構築</a><a title="All pages tagged &#39;pulseaudio&#39;." href="/tags/pulseaudio.html" class="ui tag label">pulseaudio</a><a title="All pages tagged &#39;bluetooth&#39;." href="/tags/bluetooth.html" class="ui tag label">bluetooth</a>
	
      </div>

    <div class="description">
      <p>実はこの環境は音声周りの環境が大分悪くて、 普段はYouTubeなどはこの環境からは利用していない。</p>
<p>今回暇だったので、せっかくなので直してみることにする。</p>
<h1 id="元々あった問題">元々あった問題</h1>
<h2 id="アプリケーション毎の音量差が激しすぎる">アプリケーション毎の音量差が激しすぎる</h2>
<p>ブラウザで流しているYouTubeの音が聞こえる程度の音量にすると、 通知が爆音でガチビビるという現象がありました。 逆に通知の音量程度にすると、YouTubeの音が全く聞こえません。</p>
<p>ちなみに、通知の音量程度にした時にPulseAudioの音量ゲージが100% なのでブラウザ側の音量が小さいのが問題です。</p>
<h2 id="Air Podsを接続して聞くと音がガビガビになる">Air Podsを接続して聞くと音がガビガビになる</h2>
<p>昔はきちんと聞こえていた(と思う)のですが、いつからか ガビガビで聞けたものじゃなくなりました。</p>
<h1 id="今回やったこと">今回やったこと</h1>
<h2 id="1. ブラウザの sink-input の音量を調節した">1. ブラウザの <code>sink-input</code> の音量を調節した</h2>
<p>詳しくは<a href="https://cj-bc.github.io/blog/posts/2022-03-13-pulseaudio-how-to-adjust-volume-of-each-application.html">前回書いたブログ</a>を参照。</p>
<p>ブラウザの音量めっっっちゃ小さくされてた(10%だった) のでそれを100%に戻したところ、 良いバランスになった</p>
<h2 id="2. Air PodsのBluetoothプロファイルを修正した">2. Air PodsのBluetoothプロファイルを修正した</h2>
<p>前に、音質周りについてプロファイルの問題うんたらと見た ことがあったな~と思ったのでそこ辺りを検索。</p>
<p>その結果 <a href="https://zenn.dev/noraworld/articles/pulseaudio-bluetooth#設定の変更">Raspberry Pi に複数の Bluetooth デバイスを接続して同時に音を流す – noraworld</a> を発見、どうやら音声通話用プロファイルと音楽用プロファイルが別に存在するらしい。</p>
<div id="ここで扱われるBluetoothプロファイルの一覧">
<table>
<thead>
<tr class="header">
<th>用途</th>
<th>略称</th>
<th>正式名称</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>音声通話用</td>
<td>HFP</td>
<td>Hands-Free Profile</td>
</tr>
<tr class="even">
<td>音楽用</td>
<td>A2DP</td>
<td>Advanced Audio Distribution Profile</td>
</tr>
</tbody>
</table>
</div>
<p>(ちなみに本当に一覧が見たければ<a href="https://www.bluetooth.com/specifications/specs/">bluetooth公式のページに</a>存在する)</p>
<p><code>pactl list sinks</code> でSinkの一覧を表示した際、</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>   シンク #1
状態: RUNNING
名前: bluez_sink.74_65_0C_F0_90_23.handsfree_head_unit
説明: Air Pods
ドライバー: module-bluez5-device.c
サンプル仕様: s16le 1ch 16000Hz
チャンネルマップ: mono
       ...
ボリューム: mono: 65536 / 100%
        バランス 0.00
ベースボリューム: 65536 / 100%
       ...
プロパティー:
 bluetooth.protocol = &quot;handsfree_head_unit&quot;
 bluetooth.codec = &quot;mSBC&quot;
 device.intended_roles = &quot;phone&quot;
               ...
</code></pre>
</div>
<p>プロパティーの下に <code>bluetooth.protocol = "handsfree_head_unit"</code> とあるので HFPになってるらしいことがわかる。 また、チャンネルマップが <code>mono</code> であることからこれはおそらくモノラル音源になっている ことがわかる。</p>
<p>またこれはあまり詳しくないので間違っているかもしれないが、 サンプル数も1ch 16000Hzとかなり低めになっていることがわかる。 (参考までに、パソコン本体のサンプル仕様は 2ch 44100Hzだった)</p>
<p>ということでこれをA2DPに切り替える。 今回はpavucontrolを使って切り替えた。</p>
<p>pavucontrolを起動したら <code class="verbatim">configure</code> タブを開き、そこに表示された BluetoothヘッドホンのProfileを <code>A2DP</code> に変更する。</p>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-13-pulseaudio-how-to-adjust-volume-of-each-application</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-13-pulseaudio-how-to-adjust-volume-of-each-application.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-13-pulseaudio-how-to-adjust-volume-of-each-application.html</id>
    <published>2022-03-13T00:00:00Z</published>
    <updated>2022-03-13T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>アプリケーション毎のオーディオレベルを調整する</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 13, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	<a title="All pages tagged &#39;pulseAudio&#39;." href="/tags/pulseAudio.html" class="ui tag label">pulseAudio</a><a title="All pages tagged &#39;linux&#39;." href="/tags/linux.html" class="ui tag label">linux</a><a title="All pages tagged &#39;環境構築&#39;." href="/tags/%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89.html" class="ui tag label">環境構築</a>
	
      </div>

    <div class="description">
      <p>PulseAudioを使用している際、たまにアプリケーション毎の 音量バランスがバグる(過剰な表現)時がある。</p>
<p>私の環境では、qutebrowserの音量が異常に小さくZoomやShotcutの 音量が異常にデカくなっており、Zoom会議に参加しながら共有された YouTubeの動画を見ることができない等の問題がありました。</p>
<h1 id="原因">原因</h1>
<p><code class="verbatim">sink-input</code> のVolumeが小さくなっていることがあります。</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb1" data-org-language="sh"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pactl</span> list sink-inputs</span></code></pre></div>
</div>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>Sink Input #37
 Driver: protocol-native.c
 Owner Module: 11
 Client: 124102
 Sink: 0
 Sample Specification: s16le 2ch 48000Hz
 Channel Map: front-left,front-right
 Format: pcm, format.sample_format = &quot;\&quot;s16le\&quot;&quot;  format.rate = &quot;48000&quot;  format.channels = &quot;2&quot;  format.channel_map = &quot;\&quot;front-left,front-right\&quot;&quot;
 Corked: no
 Mute: no
 Volume: front-left: 65536 / 100% / 0.00 dB,   front-right: 65536 / 100% / 0.00 dB
         balance 0.00
 Buffer Latency: 131813 usec
 Sink Latency: 100186 usec
 Resample method: speex-float-1
 Properties:
  media.name = &quot;Audio Stream&quot;
  application.name = &quot;shotcut&quot;
  native-protocol.peer = &quot;UNIX socket client&quot;
  native-protocol.version = &quot;35&quot;
  application.process.id = &quot;882662&quot;
  application.process.user = &quot;me&quot;
  application.process.host = &quot;myHost&quot;
  application.process.binary = &quot;shotcut&quot;
  application.language = &quot;C&quot;
  window.x11.display = &quot;:0&quot;
  application.process.machine_id = &quot;&lt;省略&gt;&quot;
  application.process.session_id = &quot;2&quot;
  module-stream-restore.id = &quot;sink-input-by-application-name:shotcut&quot;

</code></pre>
</div>
<p>この中の <code>Volume:</code> に表示されているのが、各Sink inputのボリュームです。 100%より小さい場合、100%にした方が良いかもしれません。 注意点として、 <strong>実際に音を鳴らしているなど音声が流れているないし流れる状態にある</strong> 必要があります。 そうでない場合、Sink inputの一覧に表示されません。</p>
<h1 id="解決方法">解決方法</h1>
<p>該当の <code class="verbatim">sink-input</code> のボリュームを100%にしてあげます。</p>
<div class="ui segment">
<div class="ui top right attached label">
bash
</div>
<div class="sourceCode" id="cb3" data-org-language="sh"><pre class="sourceCode bash SourceCode"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pactl</span> set-sink-input-volume <span class="op">&lt;</span>ID<span class="op">&gt;</span> 100%</span></code></pre></div>
</div>
<p>SinkのIDは、先程の <code>pactl list sink-inputs</code> の冒頭にある</p>
<div class="ui segment">
<div class="ui top right attached label">

</div>
<pre class="SourceCode"><code>Sink Input #37
</code></pre>
</div>
<p>の#以降の数字で、この例だと37です。</p>
<h1 id="解説">解説</h1>
<p>PulseAudioでは、全てのアプリケーションは "client" としてサーバーに接続されます。 そして各アプリケーションに於いて何かしら音声が流れると、新しい <code class="verbatim">sink-input</code> が作成 されて登録されます。ここから、音声が <code class="verbatim">sink</code> に渡って音が鳴るわけです。</p>
<p>この <code class="verbatim">sink-input</code> にはそれぞれにボリュームが設定されているので、そこを調節してあげると アプリケーション間のボリューム調整ができます。</p>
<p>PulseAudioの仕組み等については、<a href="https://gavv.github.io/articles/pulseaudio-under-the-hood/#sound-processing">Pulseaudio under the hood</a>というブログ記事が、 公式で紹介されているほど詳しいです。</p>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-12-rust-sdtin-read-until-eof-line-by-line</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-12-rust-sdtin-read-until-eof-line-by-line.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-12-rust-sdtin-read-until-eof-line-by-line.html</id>
    <published>2022-03-12T00:00:00Z</published>
    <updated>2022-03-12T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>Stdinから一行ずつEOFまで読み込む時気をつけること</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 12, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	<a title="All pages tagged &#39;rust&#39;." href="/tags/rust.html" class="ui tag label">rust</a>
	
      </div>

    <div class="description">
      <p>一行一行読み込みたい場合、恐らく <a href="https://doc.rust-lang.org/stable/std/io/struct.Stdin.html#method.read_line">std::io::Stdin::read<sub>line</sub></a>を使うと思う。 これは</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> read_line(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> buf<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="dt">String</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">usize</span><span class="op">&gt;</span></span></code></pre></div>
</div>
<p>という型を持つが、 <strong>EOFが来た時は <code>Ok(0)</code> を返す</strong> 。 なので、EOFまで一行一行読んで何かしたい場合、</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="Okな例"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="Okな例-1"><a href="#Okな例-1" aria-hidden="true" tabindex="-1"></a>   <span class="kw">let</span> <span class="kw">mut</span> buf <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="Okな例-2"><a href="#Okな例-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="Okな例-3"><a href="#Okな例-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Ok</span>(bytes) <span class="op">=</span> <span class="pp">std::io::</span>stdin()<span class="op">.</span>read_line(<span class="op">&amp;</span>buf) <span class="op">{</span></span>
<span id="Okな例-4"><a href="#Okな例-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> bytes <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="Okな例-5"><a href="#Okな例-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">break</span><span class="op">;</span></span>
<span id="Okな例-6"><a href="#Okな例-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="Okな例-7"><a href="#Okな例-7" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="Okな例-8"><a href="#Okな例-8" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</div>
<p>として <strong>戻り値が0の場合ループを終了する処理を入れる必要がある</strong> 。 私は <code>Err()</code> でくるかと思ってしまいハマった。なんともな… 型を信用しすぎたというか…ドキュメント読んでなかったというか… (本体のドキュメントにないんだもん気付かんわ!!!)</p>
<h1 id="参考資料">参考資料</h1>
<ul>
<li><a href="https://doc.rust-lang.org/stable/std/io/trait.BufRead.html#method.read_line">std::io::BufRead::read<sub>line</sub></a></li>
</ul>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-11</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-11.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-11.html</id>
    <published>2022-03-11T00:00:00Z</published>
    <updated>2022-03-11T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>2022/03/11</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March 11, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	<a title="All pages tagged &#39;elisp&#39;." href="/tags/elisp.html" class="ui tag label">elisp</a>
	
      </div>

    <div class="description">
      <h1 id="やったこと">やったこと</h1>
<ul>
<li>散歩にいった(えらい)</li>
<li><a href="https://github.com/Cj-bc/dotfiles/blob/master/dotfiles/bin/screenshot">bin/screenshot</a>の作成(スクショ用の小さなスクリプト)</li>
</ul>
<h1 id="知ったこと">知ったこと</h1>
<ul>
<li><a href="http://osmo-pim.sourceforge.net/">osmo – handy personal organizer</a></li>
</ul>
<h2 id="orgのRadio targetの仕組み">orgのRadio targetの仕組み</h2>
<p>Radio target(<a href="info:org#Radio targets">info:org#Radio targets</a>)を作成後、 <code>C-c C-c</code> すると help:org-activate-target-links が実行され、 help:org-target-link-regexp が更新される。</p>
<p>リンクを起動する際は <code>C-c C-o</code> によって help:org-open-at-point が呼ばれ、 help:org-link-open が呼ばれる。 Radio Targetの場合、 help:org-link–search-radio-target を呼び、そいつが バッファ内からターゲットを探し出して移動する。</p>
<h1 id="やること">やること</h1>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-03-06</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-03-06.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-03-06.html</id>
    <published>2022-03-06T00:00:00Z</published>
    <updated>2022-03-06T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>2022/03/06</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on March  6, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	<a title="All pages tagged &#39;rust&#39;." href="/tags/rust.html" class="ui tag label">rust</a>
	
      </div>

    <div class="description">
      <h1 id="やったこと">やったこと</h1>
<h1 id="知ったこと">知ったこと</h1>
<h2 id="型変換には as キーワードが使える Rust">型変換には <code>as</code> キーワードが使える <span class="tag" data-tag-name="Rust"><span class="smallcaps">Rust</span></span></h2>
<p>型変換には <code>try_from().unwrap()</code> とか使っていたけれど、 実はプリミティブ型なら <a href="https://doc.rust-lang.org/std/keyword.as.html"> <code>as</code> キーワード</a>である程度出来る。 例えば、以下の二つは等価。</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">u32</span><span class="pp">::</span>try_from(<span class="dv">1</span>)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="kw">as</span> <span class="dt">u32</span></span></code></pre></div>
</div>
<h2 id="Iteratorの中に入ったOptionを外したいならflatmap Rust">Iteratorの中に入ったOptionを外したいならflat<sub>map</sub> <span class="tag" data-tag-name="Rust"><span class="smallcaps">Rust</span></span></h2>
<p><code>impl Iterator&lt;Option&lt;T&gt;&gt;</code> を <code>impl Iterator&lt;T&gt;</code> に変換したい場合、 <code>flat_map</code> でいける。 Haskelでいうところの <code>catMaybes :: [Maybe a] -&gt; [a]</code> に近い挙動をする。</p>
<p>元々こうやってたのが</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> texts <span class="op">=</span> <span class="pp">vec!</span>[<span class="st">&quot;this is&quot;</span><span class="op">,</span> <span class="st">&quot;an&quot;</span><span class="op">,</span> <span class="st">&quot;example&quot;</span>]<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> v <span class="op">=</span> <span class="pp">vec!</span>[<span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>v<span class="op">.</span>map(<span class="op">|</span>idx<span class="op">|</span> texts<span class="op">.</span>get(idx))<span class="op">.</span>filter(<span class="op">|</span>val<span class="op">|</span> val<span class="op">.</span>is_some())<span class="op">.</span>map(<span class="op">|</span>val<span class="op">|</span> val<span class="op">.</span>unwrap())</span></code></pre></div>
</div>
<p>こう書ける</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> texts <span class="op">=</span> <span class="pp">vec!</span>[<span class="st">&quot;this is&quot;</span><span class="op">,</span> <span class="st">&quot;an&quot;</span><span class="op">,</span> <span class="st">&quot;example&quot;</span>]<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> v <span class="op">=</span> <span class="pp">vec!</span>[<span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>v<span class="op">.</span>filter_map(<span class="op">|</span>idx<span class="op">|</span> texts<span class="op">.</span>get(idx)<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="マイクラのサイト">マイクラのサイト</h2>
<p><a href="https://njf.jp/minecraft/articles/2020-09-13-hoe.html">https://njf.jp/minecraft/articles/2020-09-13-hoe.html</a></p>
<p>新しい仕組みになってからの村周りの情報とかがあってよい。</p>
<h1 id="やること">やること</h1>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-02-27</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-02-27.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-02-27.html</id>
    <published>2022-02-27T00:00:00Z</published>
    <updated>2022-02-27T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>2022/02/27</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on February 27, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	
	
      </div>

    <div class="description">
      <h1 id="出来事">出来事</h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=Ev5qzT0VnTo">みあちゃんスプラ大会配信</a></li>
<li><a href="https://www.youtube.com/watch?v=GTa2HxIsBPM">Kizuna AI last live</a></li>
<li>AIちゃんスリープ</li>
<li><a href="https://www.youtube.com/watch?v=v3yWm0Crtaw">ゆあちゃんエルデン24時間耐久(前半)</a></li>
<li><a href="https://twitter.com/nalgami/status/1497372362857410560?s=20&amp;t=LkmskTlFlhhJ_pjBXMqLYA">POLYGON TAILOR IMPORT最初のFACEATSM BUG MA-1</a>発売日アナウンス、3/1発売</li>
</ul>
<h1 id="やったこと">やったこと</h1>
<ul>
<li>piping-server-rustにクリップボード連携機能を自分用に作成した
<ul>
<li><a href="https://github.com/nwtgck/piping-server-rust">nwtgck/piping-server-rust</a>のコード読んだ</li>
<li><a href="https://doc.rust-jp.rs/book-ja/">The Rust Programming Language 日本語版</a>の1,3章読んだ</li>
</ul></li>
<li>配信見てた</li>
</ul>
<h1 id="知ったこと">知ったこと</h1>
<ul>
<li>Rustの基礎をちょこっと</li>
<li><a href="https://docs.rs/crate/clipboard/0.5.0">Rust – Clipboard</a></li>
<li>Rustで子プロセスを作成するには <code>std::process::Command</code></li>
<li>子プロセスとの通信は <code>std::process::Stdio</code></li>
<li>RustでHttpのBody取るには <code>hyper::body::to_bytes</code> が使える</li>
</ul>
<h2 id="Rustで子プロセス">Rustで子プロセス</h2>
<ol>
<li><p>子プロセスの作成:</p>
<ul>
<li><a href="https://doc.rust-lang.org/std/process/struct.Command.html#method.stdin">std::process::Command</a></li>
<li><a href="https://doc.rust-lang.org/std/process/struct.Command.html#method.spawn">std::process::Command.spawn()</a></li>
</ul>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> child<span class="op">:</span> Child <span class="op">=</span> <span class="pp">Command::</span>new(<span class="st">&quot;xsel&quot;</span>)<span class="op">.</span>arg(<span class="st">&quot;-xb&quot;</span>)<span class="op">.</span>stdin(<span class="pp">Stdio::</span>piped())<span class="op">.</span>spawn()<span class="op">.</span>expect(<span class="st">&quot;Failed to spawn child process&quot;</span>)</span></code></pre></div>
</div></li>
<li><p>パイプへの書き込み</p>
<ul>
<li><a href="https://doc.rust-lang.org/std/process/struct.Child.html">std::process::Child</a></li>
<li><a href="https://doc.rust-lang.org/std/process/struct.ChildStdin.html">std::process::ChildStdin</a></li>
</ul>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// takeよくわかってない</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> b<span class="op">:</span> Bytes <span class="op">=</span> <span class="co">// </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>child<span class="op">.</span>stdin<span class="op">.</span>take()<span class="op">.</span>expect(<span class="st">&quot;failed to open stdin&quot;</span>)<span class="op">.</span>write(b)<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div></li>
</ol>
<h1 id="やること">やること</h1>
    </div>
  </div>
  

</div>
]]></summary>
</entry>
<entry>
    <title>2022-02-26-rust-hyper-convert-body-into-bytes</title>
    <link href="https://cj-bc.github.io/blog/posts/2022-02-26-rust-hyper-convert-body-into-bytes.html" />
    <id>https://cj-bc.github.io/blog/posts/2022-02-26-rust-hyper-convert-body-into-bytes.html</id>
    <published>2022-02-26T00:00:00Z</published>
    <updated>2022-02-26T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div id="body-content">
  <div class="content">
    <div class="ui center aligned icon header">
      <h1>HttpのリクエストからBodyをBytesで取り出す</h1>
    </div>
      <div class="meta ui list">
	<div class="item">Posted on February 26, 2022</div>
	<div class="item">
	  <i class="history icon"></i>
	  Updated on March 13, 2022
	</div>

	

	
	<a title="All pages tagged &#39;rust&#39;." href="/tags/rust.html" class="ui tag label">rust</a><a title="All pages tagged &#39;hyper&#39;." href="/tags/hyper.html" class="ui tag label">hyper</a><a title="All pages tagged &#39;http&#39;." href="/tags/http.html" class="ui tag label">http</a>
	
      </div>

    <div class="description">
      <p><a href="https://docs.rs/crate/hyper/0.13.8">Hyper</a>の<a href="https://docs.rs/hyper/0.13.8/hyper/body/struct.Body.html">Body</a>を<a href="https://docs.rs/hyper/0.13.8/hyper/body/struct.Bytes.html">Bytes</a>に変換する方法について、何気に調べるの苦労したのでメモ。</p>
<p><code>hyper::body</code> に用意されている <a href="https://docs.rs/hyper/0.13.8/hyper/body/fn.to_bytes.html">to<sub>bytes</sub></a>関数を使えばよい。</p>
<p>HttpのRequrestからBodyは <a href="https://docs.rs/http/0.2.1/http/request/struct.Request.html#method.into_body"> <code>into_body</code> </a>で取れるので、それを <code>to_bytes</code> に与えてあげる。 つまり:</p>
<div class="ui segment">
<div class="ui top right attached label">
rust
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust SourceCode"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> bytes_body<span class="op">:</span> Bytes <span class="op">=</span> <span class="pp">hyper::body::</span>to_bytes(req<span class="op">.</span>into_body())</span></code></pre></div>
</div>
    </div>
  </div>
  

</div>
]]></summary>
</entry>

</feed>
